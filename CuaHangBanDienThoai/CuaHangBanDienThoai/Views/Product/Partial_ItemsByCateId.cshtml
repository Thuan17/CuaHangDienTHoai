@model IEnumerable<CuaHangBanDienThoai.Models.ProductDetail>
@using CuaHangBanDienThoai.Common

<div class=" product__grid">

</div>

@if (Model != null)
{
    foreach (var item in Model)
    {
        @functions {

            public decimal CalculateDiscountPercentage(decimal originalPrice, decimal salePrice)
            {
                if (originalPrice == 0 || salePrice >= originalPrice)
                {
                    return 0; // Trả về 0 nếu giá gốc bằng 0 hoặc giá bán lớn hơn hoặc bằng giá gốc
                }

                decimal discount = 1 - (salePrice / originalPrice);
                return discount * 100;
            }
        }
        var strImg = "";
        var CheckImage = item.ProductDetailImage.FirstOrDefault(x => x.IsDefault == true);
        var Name = item.Products.ProductCategory.Title.Trim() + "   " + item.Products.Title.Trim();
        if (CheckImage != null)
        {
            strImg = CheckImage.Image;
        }
        else
        {
            strImg = "~/images/logo/logoWeb.png";
        }


        @*<a href="/chi-tiet/@item.Alias-p@(item.ProductsId)" class="col-lg-3 col-md-4 col-sm-6 col-6 mb-2  mt-2  product-item    @item.ProductCategory.Alias">

            </a>*@

        <div class="col-lg-3 col-md-4 col-sm-6 col-6   mb-2  mt-2  product-item    @item.Products.ProductCompany.Alias.Trim()">
            <div class="  product__item   product discount product_filter_item  ">

                <div class="product_image__item">
                    <a a href="/chi-tiet/@item.Alias-p@(item.ProductsId)" class="p-0">
                        <img src="@strImg" alt="@Name-TenoStore">
                    </a>


                </div>
                @*<div class="product_bubble product_bubble_left product_bubble_green d-flex flex-column align-items-center"><span>new</span></div>*@
                @if (item.IsSale == true && item.PriceSale > 0)
                {
                    <div class="product_bubble product_bubble_right product_bubble_red d-flex flex-column align-items-center">
                        @{
                            decimal originalPrice = Convert.ToDecimal(item.Price);
                            decimal salePrice = Convert.ToDecimal(item.PriceSale);
                            decimal discountPercentage = CalculateDiscountPercentage(originalPrice, salePrice);
                        }
                        @if (discountPercentage > 0)
                        {
                            <span>-@discountPercentage.ToString("0")%</span>
                        }
                    </div>
                }

                <div class="product_info ">
                    <h5 class="product_name m-0 align-items-center text-center" style="height: 50px; text-align: center; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                        <a href="/chi-tiet/@item.Alias-p@(item.ProductsId)" class="product_name">@Name</a>
                    </h5>
                    @if (item.PriceSale > 0)
                    {

                        <div class="product_price  text-danger w-100">
                            @Html.Raw($"{Common.FormatNumber(item.PriceSale)}&#8363;")
                            <span>@Html.Raw($"{Common.FormatNumber(item.Price)}&#8363;")</span>
                        </div>
                    }
                    else
                    {
                        <div class="product_price text-danger">
                            @Html.Raw($"{Common.FormatNumber(item.Price)}&#8363;")
                        </div>
                    }

                </div>

                <div class="">
                    <a href="javascript:void(0);" class="btnbuynow btnAddtoCartItem" data-productid="@item.ProductsId">Mua ngay</a>
                </div>
            </div>
        </div>





    }
}